<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · LLVM.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>LLVM.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href="index.html">Home</a><ul class="internal"><li><a class="toctext" href="#Installation-1">Installation</a></li></ul></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="man/usage.html">Usage</a></li><li><a class="toctext" href="man/troubleshooting.html">Troubleshooting</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="lib/api.html">API wrappers</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="index.html">Home</a></li></ul><a class="edit-page" href="https://github.com/maleadt/LLVM.jl/tree/cb1b25827c35ea11c4ae142652933b73a5950f59/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="LLVM.jl-1" href="#LLVM.jl-1">LLVM.jl</a></h1><p><em>A Julia wrapper for the LLVM C API.</em></p><p>This package provides a shallow wrapper around the LLVM C API. The entire API, wrapped by means of <a href="https://github.com/ihnorton/Clang.jl/">Clang.jl</a>, is available in the <code>LLVM.API</code> submodule. Higher-level wrappers are part of the <code>LLVM</code> top-level module, and are added as the need arises (see <a href="https://github.com/maleadt/LLVM.jl/blob/master/COVERAGE.md">COVERAGE.md</a> for a list of wrapped functions).</p><h2><a class="nav-anchor" id="Installation-1" href="#Installation-1">Installation</a></h2><p>Requirements:</p><ul><li><p>LLVM 3.9 or higher, in full (ie. not only <code>libLLVM.so</code>, but also <code>llvm-config</code>, headers, etc)</p></li><li><p>Julia 0.5 or higher</p></li><li><p>C++ compiler, and possibly some development headers (like <code>libz1</code>, <code>zlib1g-dev</code> on many popular Linux distributions)</p></li></ul><pre><code class="language-none">Pkg.add(&quot;LLVM&quot;)
using LLVM

# optionally
Pkg.test(&quot;LLVM&quot;)</code></pre><p>The build step (executed by <code>Pkg.add</code>) detects available LLVM installations and builds a library with additional API functions. The best matching installation of LLVM will be selected, but any version can be forced by setting the <code>LLVM_VER</code> environment variable at build time. The script will only load LLVM libraries bundled with Julia, but that can be overridden by defining <code>USE_SYSTEM_LLVM</code>. However, that option is experimental and likely to break. Your best bet is to build Julia from source, and run it from the build tree <strong>without running <code>make install</code></strong>. Binary versions of Julia are not compatible with LLVM.jl.</p><p>If installation fails, re-run the failing steps with the <code>DEBUG</code> environment variable set to <code>1</code> and attach that output to a bug report:</p><pre><code class="language-none">$ DEBUG=1 julia
julia&gt; Pkg.build(&quot;LLVM&quot;)
...</code></pre><p>Even if the build fails, LLVM.jl should always be loadable. This simplifies use by downstream packages, until there is proper language support for conditional modules. You can check whether the package has been built properly by inspecting the <code>LLVM.configured</code> global variable.</p><h3><a class="nav-anchor" id="System-provided-LLVM-1" href="#System-provided-LLVM-1">System-provided LLVM</a></h3><p>Loading LLVM.jl with a system-provided LLVM library is an experimental option, only supported on Linux, and partially cripples functionality of this package. The problem stems from how loading multiple copies of LLVM makes global symbols clash (despite using <code>RTLD_LOCAL|RTLD_DEEPBIND</code>), corrupting the state of either library when performing certain calls like <code>LLVMShutdown</code>.</p><p>On Linux, we have <code>dlmopen</code> to load the LLVM library in a separate library namespace <a href="#footnote-apple">[apple]</a>. However, this newly created namespace is completely empty, and does not include <code>libjulia</code> either. As a result, we cannot call back into the compiler, breaking functionality such as the Julia-callbacks for LLVM passes.</p><div class="footnote" id="footnote-apple"><a href="#footnote-apple"><strong>[apple]</strong></a><p>This is supposed to work on macOS too, but I haven&#39;t been able to get it working. Certain lookups resolve across libraries, despite using <code>RTLD_DEEPBIND</code>:</p><pre><code class="language-none">frame 0: libsystem_malloc.dylib  malloc_error_break
frame 1: libsystem_malloc.dylib  free
frame 2: libLLVM-3.7.dylib       llvm::DenseMapBase&lt;...&gt;*)
frame 3: libLLVM-3.7.dylib       unsigned int llvm::DFSPass&lt;...&gt;::NodeType*, unsigned int)
frame 4: libLLVM-3.7.dylib       void llvm::Calculate&lt;...&gt;&amp;, llvm::Function&amp;)
frame 5: libLLVM.dylib           (anonymous namespace)::Verifier::verify(llvm::Function const&amp;)
frame 6: libLLVM.dylib           llvm::verifyModule(llvm::Module const&amp;, llvm::raw_ostream*, bool*)
frame 7: libLLVM.dylib           LLVMVerifyModule</code></pre></div><footer><hr/><a class="next" href="man/usage.html"><span class="direction">Next</span><span class="title">Usage</span></a></footer></article></body></html>
